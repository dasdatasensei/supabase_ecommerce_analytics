version: 2

models:
  - name: mart_customer_analytics
    description: >
      Customer analytics mart that provides a comprehensive view of customer behavior, value, and satisfaction.
      This model combines transactional data with segmentation logic to enable customer-centric analysis
      and personalization strategies.
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - unique
          - not_null

      - name: frequency_segment
        description: >
          Customer segment based on order frequency.
          - High: More than 5 orders
          - Medium: 2-5 orders
          - Low: 1 order
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: value_segment
        description: >
          Customer segment based on total spend.
          - High: Top 20% of customers by spend
          - Medium: Middle 60% of customers by spend
          - Low: Bottom 20% of customers by spend
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: nps_segment
        description: >
          Customer segment based on average review scores.
          - Promoter: Average score >= 4
          - Passive: Average score 3-4
          - Detractor: Average score < 3
        tests:
          - accepted_values:
              values: ["Promoter", "Passive", "Detractor"]

      - name: customer_tier
        description: >
          Composite customer tier combining frequency and value segments.
          - VIP: High frequency & High value
          - Loyal: High frequency & Medium value
          - Growing: Medium frequency & (High/Medium value)
          - Big Spender: Low frequency & High value
          - Standard: All other combinations
        tests:
          - accepted_values:
              values: ["VIP", "Loyal", "Growing", "Big Spender", "Standard"]

      - name: total_spent
        description: "Total amount spent by the customer across all orders"
        tests:
          - not_null
          - positive_value

      - name: avg_order_value
        description: "Average order value for the customer"
        tests:
          - not_null
          - positive_value

      - name: avg_review_score
        description: "Average review score given by the customer (1-5 scale)"
        tests:
          - not_null
          - between:
              min_value: 1
              max_value: 5

      - name: customer_lifetime_days
        description: "Number of days between first and last order"
        tests:
          - not_null
          - positive_value

      - name: daily_customer_value
        description: "Average daily revenue generated by the customer"
        tests:
          - not_null

  - name: mart_seller_analytics
    description: >
      Seller analytics mart that provides insights into seller performance, delivery efficiency,
      and customer satisfaction. This model enables seller relationship management and
      performance optimization strategies.
    columns:
      - name: seller_id
        description: "Unique identifier for the seller"
        tests:
          - unique
          - not_null

      - name: volume_segment
        description: >
          Seller segment based on order volume.
          - High: Top 20% of sellers by order count
          - Medium: Middle 60% of sellers by order count
          - Low: Bottom 20% of sellers by order count
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: value_segment
        description: >
          Seller segment based on GMV.
          - High: Top 20% of sellers by GMV
          - Medium: Middle 60% of sellers by GMV
          - Low: Bottom 20% of sellers by GMV
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: performance_segment
        description: >
          Seller segment based on overall performance metrics.
          - Excellent: High satisfaction & delivery scores
          - Good: Above average performance
          - Fair: Average performance
          - Poor: Below average performance
        tests:
          - accepted_values:
              values: ["Excellent", "Good", "Fair", "Poor"]

      - name: seller_tier
        description: >
          Composite seller tier based on performance and delivery segments.
          - Elite: Excellent performance & delivery
          - Premium: Good/Excellent performance & delivery
          - Standard: Fair performance & delivery
          - At Risk: Poor performance or delivery
        tests:
          - accepted_values:
              values: ["Elite", "Premium", "Standard", "At Risk"]

      - name: total_gmv
        description: "Total Gross Merchandise Value generated by the seller"
        tests:
          - not_null
          - positive_value

      - name: on_time_delivery_rate
        description: "Percentage of orders delivered within estimated delivery date"
        tests:
          - not_null
          - between:
              min_value: 0
              max_value: 1

      - name: mom_growth_rate
        description: "Month-over-month GMV growth rate"
        tests:
          - not_null

  - name: mart_product_analytics
    description: >
      Product analytics mart that combines performance metrics, category analysis,
      and logistics data. This model enables product portfolio management,
      inventory optimization, and category strategy development.
    columns:
      - name: product_id
        description: "Unique identifier for the product"
        tests:
          - unique
          - not_null

      - name: volume_segment
        description: >
          Product segment based on order volume.
          - High: Top 20% of products by order count
          - Medium: Middle 60% of products by order count
          - Low: Bottom 20% of products by order count
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: price_segment
        description: >
          Product segment based on average price.
          - Premium: Top 20% of products by price
          - Standard: Middle 60% of products by price
          - Budget: Bottom 20% of products by price
        tests:
          - accepted_values:
              values: ["Premium", "Standard", "Budget"]

      - name: product_tier
        description: >
          Composite product tier based on volume and price segments.
          - Premium: High volume & Premium price
          - Popular: High volume & High rating
          - Standard: Average performance
          - At Risk: Low volume & Low rating
        tests:
          - accepted_values:
              values: ["Premium", "Popular", "Standard", "At Risk"]

      - name: logistics_complexity
        description: >
          Product classification based on shipping complexity.
          - High: Heavy weight or large size
          - Medium: Average weight and size
          - Low: Light weight and small size
        tests:
          - accepted_values:
              values: ["High", "Medium", "Low"]

      - name: total_gmv
        description: "Total Gross Merchandise Value generated by the product"
        tests:
          - not_null
          - positive_value

      - name: avg_review_score
        description: "Average review score for the product (1-5 scale)"
        tests:
          - not_null
          - between:
              min_value: 1
              max_value: 5

      - name: category_relative_gmv
        description: "Product's GMV relative to category average (>1 means above average)"
        tests:
          - not_null

tests:
  - name: positive_value
    description: "Ensures that a numeric value is greater than zero"
    test_metadata:
      name: "positive_value"
      kwargs:
        field: "{{ column_name }}"
